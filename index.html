<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ (Speech-to-Text)</title>
  <style>
    body {
      margin: 0; font-family: Arial, sans-serif; background: #f5f5f5;
      text-align: center; overflow: hidden; padding: 10px;
    }
    h2 {
      background:#fff8e1; color:#795548; border:1px solid #ffe0b2;
      border-radius:8px; padding:6px; font-size:16px; margin-bottom:10px;
    }
    #output {
      width:100%; height:60vh; background:#fff; border:1px solid #ccc;
      border-radius:10px; text-align:left; padding:10px; overflow-y:auto;
      font-size:24px; white-space:pre-wrap;
    }
    button {
      margin:5px; padding:10px 16px; font-size:20px;
      border:none; border-radius:8px; color:#fff; cursor:pointer;
    }
    #mic { background:#4caf50; }
    #live { background:#2196f3; }
    #stopLive { background:#ff9800; display:none; }
    #erase { background:#f44336; }
  </style>
</head>
<body>

  <h2>üéôÔ∏è ‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‚Äì ‡§¨‡•ã‡§≤‡§ø‡§è ‡§î‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§¶‡•á‡§ñ‡§ø‡§è</h2>
  <div id="output">‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ...</div>
  <div>
    <button id="mic">üé§ ‡§¨‡•ã‡§≤‡§ø‡§è</button>
    <button id="live">üéß ‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§</button>
    <button id="stopLive">‚èπ ‡§∞‡•ã‡§ï‡§ø‡§è</button>
    <button id="erase">üßπ ‡§Æ‡§ø‡§ü‡§æ‡§á‡§è</button>
  </div>

  <script>
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const out = document.getElementById("output");
    const mic = document.getElementById("mic");
    const live = document.getElementById("live");
    const stopLive = document.getElementById("stopLive");
    const erase = document.getElementById("erase");

    if (!SpeechRecognition) {
      out.innerText = "‡§Ü‡§™‡§ï‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ Speech Recognition ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§";
    }

    // Single-press (non-live)
    const rec = new SpeechRecognition();
    rec.lang = "hi-IN";
    rec.interimResults = false;
    rec.maxAlternatives = 1;

    mic.onclick = () => {
      rec.start();
      out.innerText = "üéôÔ∏è ‡§Æ‡§æ‡§á‡§ï ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à...";
    };

    rec.onresult = e => { out.innerText = e.results[0][0].transcript; };
    rec.onerror = e => { out.innerText = "‚ö†Ô∏è ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + e.error; };

    // LIVE conversation mode
    const liveRec = new SpeechRecognition();
    liveRec.lang = "hi-IN";
    liveRec.interimResults = true;
    liveRec.continuous = true;

    let isLive = false, fullText = "", lastFinal = "", lastTime = 0;

    live.onclick = () => {
      isLive = true;
      fullText = ""; lastFinal = ""; lastTime = 0;
      out.innerText = "üéß ‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§∂‡•Å‡§∞‡•Ç... ‡§¨‡•ã‡§≤‡§ø‡§è‡•§";
      live.style.display = "none"; stopLive.style.display = "inline-block";
      startLive();
    };

    function startLive() { try { liveRec.start(); } catch(e){} }

    function similarity(a,b){
      if(!a||!b) return 0;
      a=a.trim(); b=b.trim();
      const shorter=a.length<b.length?a:b, longer=a.length<b.length?b:a;
      if(longer.length===0) return 1;
      let same=0;
      for(let i=0;i<shorter.length;i++){
        if(longer[i]===shorter[i]) same++;
      }
      return same/longer.length;
    }

    liveRec.onresult = e => {
      let interim="";
      for(let i=e.resultIndex;i<e.results.length;i++){
        const res=e.results[i], txt=res[0].transcript.trim();
        if(res.isFinal){
          const now=Date.now();
          const sim=similarity(txt,lastFinal);
          if(sim<0.9 || now-lastTime>2000){   // ignore near-duplicates
            fullText += (fullText ? " " : "") + txt;
            lastFinal = txt; lastTime = now;
          }
        } else { interim += txt + " "; }
      }
      out.innerText = fullText + (interim ? "\n" + interim.trim() : "");
      out.scrollTop = out.scrollHeight;
    };

    let restarting=false;
    liveRec.onend = () => {
      if(!isLive) return;
      if(restarting) return;
      restarting=true;
      setTimeout(()=>{restarting=false; if(isLive) startLive();},500);
    };

    liveRec.onerror = e => {
      if(e.error!=="no-speech" && e.error!=="aborted"){
        out.innerText += "\n‚ö†Ô∏è ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + e.error;
      }
    };

    stopLive.onclick = () => {
      isLive=false;
      try{liveRec.stop();}catch(e){}
      stopLive.style.display="none"; live.style.display="inline-block";
      out.innerText = fullText + "\nüõë ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§∞‡•ã‡§ï ‡§¶‡•Ä ‡§ó‡§à‡•§";
    };

    erase.onclick = () => {
      fullText=""; lastFinal=""; out.innerText="‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ...";
    };
  </script>
</body>
</html>
