<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      overflow: hidden; /* No full page scroll */
      text-align: center;
      padding: 10px;
    }
    h2 {
      margin: 4px 0 10px;
      padding: 8px;
      font-size: 17px;
      background:#fff8e1;
      color:#795548;
      border:1px solid #ffe0b2;
      border-radius:8px;
      line-height:1.3;
    }
    #output {
      width:100%;
      height:56vh;
      padding:12px;
      font-size:26px;
      background:#fff;
      border-radius:10px;
      border:1px solid #ccc;
      text-align:left;
      overflow-y:auto; /* Only scroll inside text box */
      white-space:pre-wrap;
    }
    button {
      padding:10px 16px;
      margin:6px;
      font-size:20px;
      border:none;
      border-radius:8px;
      color:#fff;
      cursor:pointer;
    }
    #mic { background:#4caf50; }
    #live { background:#2196f3; }
    #stopLive { background:#ff9800; display:none; }
    #erase { background:#f44336; }
  </style>
</head>
<body>

  <h2>üéôÔ∏è ‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‚Äî ‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§∏‡•á ‡§¨‡•ã‡§≤‡§ø‡§è</h2>

  <div id="output">‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ...</div>

  <div>
    <button id="mic">üé§ ‡§¨‡•ã‡§≤‡§ø‡§è</button>
    <button id="live">üéß ‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§</button>
    <button id="stopLive">‚èπ ‡§∞‡•ã‡§ï‡§ø‡§è</button>
    <button id="erase">üßπ ‡§Æ‡§ø‡§ü‡§æ‡§á‡§è</button>
  </div>

  <script>
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const output = document.getElementById("output");
    const mic = document.getElementById("mic");
    const live = document.getElementById("live");
    const stopLive = document.getElementById("stopLive");
    const erase = document.getElementById("erase");

    if (!SpeechRecognition) {
      output.innerText = "‡§Ü‡§™‡§ï‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ Speech Recognition ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§ Chrome ‡§Ø‡§æ Edge ‡§Ü‡§ú‡§º‡§Æ‡§æ‡§è‡§Å‡•§";
    }

    // Single speech (non-live)
    const rec = new SpeechRecognition();
    rec.lang = "hi-IN";
    rec.interimResults = false;
    rec.maxAlternatives = 1;

    mic.onclick = () => {
      rec.start();
      output.innerText = "üéôÔ∏è ‡§Æ‡§æ‡§á‡§ï ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à...";
    };

    rec.onresult = (e) => {
      output.innerText = e.results[0][0].transcript;
    };

    rec.onerror = (e) => {
      output.innerText = "‚ö†Ô∏è ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + e.error;
    };

    // LIVE mode
    const liveRec = new SpeechRecognition();
    liveRec.lang = "hi-IN";
    liveRec.interimResults = true;
    liveRec.continuous = true;

    let isLive = false;
    let committed = "";
    let lastFinal = "";
    let lastTime = 0;
    let restarting = false;

    live.onclick = () => {
      isLive = true;
      committed = "";
      lastFinal = "";
      output.innerText = "üéß ‡§≤‡§æ‡§á‡§µ ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§∂‡•Å‡§∞‡•Ç... ‡§¨‡•ã‡§≤‡§ø‡§è‡•§";
      live.style.display = "none";
      stopLive.style.display = "inline-block";
      startLive();
    };

    function startLive() {
      try { liveRec.start(); } catch (err) {}
    }

    liveRec.onresult = (event) => {
      let interim = "";
      for (let i = event.resultIndex; i < event.results.length; i++) {
        const res = event.results[i];
        const txt = res[0].transcript.trim();
        if (res.isFinal) {
          // ‚úÖ Deduplicate by checking last text + timestamp
          const now = Date.now();
          if (txt && (txt !== lastFinal || now - lastTime > 1200)) {
            committed += (committed ? " " : "") + txt;
            lastFinal = txt;
            lastTime = now;
          }
        } else {
          interim += txt + " ";
        }
      }
      output.innerText = committed + (interim ? "\n" + interim.trim() : "");
      output.scrollTop = output.scrollHeight;
    };

    liveRec.onerror = (e) => {
      if (e.error !== "no-speech" && e.error !== "aborted") {
        output.innerText += "\n‚ö†Ô∏è ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: " + e.error;
      }
    };

    liveRec.onend = () => {
      if (!isLive) return;
      if (restarting) return;
      restarting = true;
      setTimeout(() => {
        restarting = false;
        if (isLive) startLive();
      }, 400);
    };

    stopLive.onclick = () => {
      isLive = false;
      try { liveRec.stop(); } catch (e) {}
      stopLive.style.display = "none";
      live.style.display = "inline-block";
      output.innerText = committed + "\nüõë ‡§¨‡§æ‡§§‡§ö‡•Ä‡§§ ‡§∞‡•ã‡§ï ‡§¶‡•Ä ‡§ó‡§à‡•§";
    };

    erase.onclick = () => {
      committed = "";
      lastFinal = "";
      output.innerText = "‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§ï‡§æ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ...";
    };
  </script>

</body>
</html>
